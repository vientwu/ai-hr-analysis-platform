<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI智能招聘分析系统 | AI Recruitment Analyzer</title>
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' http://127.0.0.1:4000 http://localhost:4000 https://*.supabase.co https://api.coze.cn https://cdn.jsdelivr.net; frame-src 'none'; object-src 'none'; base-uri 'self';">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="css/reports.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- 内置图标，避免 favicon.ico 404 -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%232563eb'/%3E%3Ctext x='32' y='42' font-size='36' text-anchor='middle' fill='white'%3EA%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-brain"></i>
                <span data-zh="必涨·AI招聘分析" data-en="Bizhang · AI Recruitment">必涨·AI招聘分析</span>
            </div>
            <div class="nav-actions">
                <nav class="nav-links">
                    <a href="resume-history.html" class="nav-link">简历分析记录</a>
                    <a href="interview-history.html" class="nav-link">面试分析记录</a>
                    <a href="index.html" class="nav-link active">分析工具</a>
                </nav>
                <button class="lang-toggle" onclick="toggleLanguage()">
                    <i class="fas fa-globe"></i>
                    <span id="lang-text">EN</span>
                </button>
                <div class="auth-actions">
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <div class="dropdown">
                            <button class="btn-secondary dropdown-toggle" id="userDropdown">
                                <span id="userDisplayName">用户</span>
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                                    <path d="M6 8L2 4h8L6 8z"/>
                                </svg>
                            </button>
                            <div class="dropdown-menu" id="dropdownMenu">
                                <a href="resume-history.html" class="dropdown-item">简历分析记录</a>
                                <a href="interview-history.html" class="dropdown-item">面试分析记录</a>
                                <button class="dropdown-item" onclick="showMyReports()">我的报告</button>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" id="logoutBtn">退出登录</button>
                            </div>
                        </div>
                    </div>
                    <button id="login-btn" class="btn-secondary" onclick="showAuthModal()" style="display: inline-flex; align-items: center; justify-content: center;">登录</button>
                    <button id="logout-btn" class="btn-secondary" style="display:none" onclick="handleLogout()">退出</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 功能选择卡片 -->
        <div class="feature-cards">
            <div class="card" id="resume-card">
                <div class="card-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 data-zh="简历分析" data-en="Resume Analysis">简历分析</h3>
                <p data-zh="上传简历和岗位JD，获得AI智能匹配分析和面试建议" data-en="Upload resume and job description for AI-powered matching analysis and interview suggestions">
                    上传简历和岗位JD，获得AI智能匹配分析和面试建议
                </p>
                <button class="btn-primary" onclick="showResumeAnalysis()">
                    <span data-zh="开始分析" data-en="Start Analysis">开始分析</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <div class="card" id="interview-card">
                <div class="card-icon">
                    <i class="fas fa-microphone"></i>
                </div>
                <h3 data-zh="面试分析" data-en="Interview Analysis">面试分析</h3>
                <p data-zh="上传面试录音转文字PDF，获得面试过程分析和改进建议" data-en="Upload interview transcript PDF for process analysis and improvement suggestions">
                    上传面试录音转文字PDF，获得面试过程分析和改进建议
                </p>
                <button class="btn-primary" onclick="showInterviewAnalysis()">
                    <span data-zh="开始分析" data-en="Start Analysis">开始分析</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- 简历分析模块 -->
        <div class="analysis-module" id="resume-module" style="display: none;">
            <div class="module-header">
                <button class="back-btn" onclick="showHome()">
                    <i class="fas fa-arrow-left"></i>
                    <span data-zh="返回" data-en="Back">返回</span>
                </button>
                <h2 data-zh="简历分析" data-en="Resume Analysis">简历分析</h2>
            </div>

            <div class="upload-section">
                <div class="upload-group">
                    <label data-zh="上传简历文件" data-en="Upload Resume File">上传简历文件</label>
                    <div class="file-upload" id="resume-upload">
                        <div class="upload-area" onclick="document.getElementById('resume-file').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p data-zh="点击或拖拽文件到此处" data-en="Click or drag file here">点击或拖拽文件到此处</p>
                            <small data-zh="支持 PDF, DOC, DOCX, TXT 格式，最大 500MB" data-en="Support PDF, DOC, DOCX, TXT formats, max 500MB">
                                支持 PDF, DOC, DOCX, TXT 格式，最大 500MB
                            </small>
                        </div>
                        <input type="file" id="resume-file" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                        <div class="file-info" id="resume-file-info" style="display: none;"></div>
                    </div>
                </div>

                <div class="upload-group">
                    <label data-zh="岗位职责描述 (JD)" data-en="Job Description (JD)">岗位职责描述 (JD)</label>
                    <textarea 
                        id="job-description" 
                        placeholder="请输入详细的岗位职责、技能要求、工作内容等信息..."
                        data-zh-placeholder="请输入详细的岗位职责、技能要求、工作内容等信息..."
                        data-en-placeholder="Please enter detailed job responsibilities, skill requirements, work content, etc..."
                    ></textarea>
                    <div class="char-count">
                        <span id="jd-char-count">0</span> / 5000
                    </div>
                </div>

                <button class="btn-analyze" id="analyze-resume-btn" onclick="analyzeResume()" disabled>
                    <i class="fas fa-cog fa-spin" style="display: none;"></i>
                    <span data-zh="开始分析简历" data-en="Start Resume Analysis">开始分析简历</span>
                </button>
            </div>

            <div class="result-section" id="resume-result" style="display: none;">
                <h3 data-zh="分析结果" data-en="Analysis Result">分析结果</h3>
                <div class="result-content markdown-content" id="resume-result-content"></div>
                <div class="result-actions">
                    <button class="btn-secondary" onclick="saveReportToSupabase('resume')">
                        <i class="fas fa-save"></i>
                        <span data-zh="保存到我的报告" data-en="Save to My Reports">保存到我的报告</span>
                    </button>
                    <button class="btn-secondary" onclick="downloadResultDocx('resume')">
                        <i class="fas fa-file-word"></i>
                        <span data-zh="下载 Word" data-en="Download Word">下载 Word</span>
                    </button>
                    <button class="btn-secondary" onclick="downloadResult('resume')">
                        <i class="fas fa-download"></i>
                        <span data-zh="下载 Markdown" data-en="Download Markdown">下载 Markdown</span>
                    </button>
                    <button class="btn-primary" onclick="resetResumeAnalysis()">
                        <span data-zh="重新分析" data-en="Analyze Again">重新分析</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 面试分析模块 -->
        <div class="analysis-module" id="interview-module" style="display: none;">
            <div class="module-header">
                <button class="back-btn" onclick="showHome()">
                    <i class="fas fa-arrow-left"></i>
                    <span data-zh="返回" data-en="Back">返回</span>
                </button>
                <h2 data-zh="面试分析" data-en="Interview Analysis">面试分析</h2>
            </div>

            <div class="upload-section">
                <div class="upload-group">
                    <label data-zh="面试者姓名" data-en="Interviewee Name">面试者姓名</label>
                    <input 
                        type="text" 
                        id="interviewee-name" 
                        placeholder="请输入面试者姓名"
                        data-zh-placeholder="请输入面试者姓名"
                        data-en-placeholder="Please enter interviewee name"
                        maxlength="50"
                    >
                </div>

                <div class="upload-group">
                    <label data-zh="面试录音转文字PDF" data-en="Interview Transcript PDF">面试录音转文字PDF</label>
                    <div class="file-upload" id="interview-upload">
                        <div class="upload-area" onclick="document.getElementById('interview-file').click()">
                            <i class="fas fa-file-pdf"></i>
                            <p data-zh="点击或拖拽PDF文件到此处" data-en="Click or drag PDF file here">点击或拖拽PDF文件到此处</p>
                            <small data-zh="仅支持 PDF 格式，最大 500MB" data-en="PDF format only, max 500MB">
                                仅支持 PDF 格式，最大 500MB
                            </small>
                        </div>
                        <input type="file" id="interview-file" accept=".pdf" style="display: none;">
                        <div class="file-info" id="interview-file-info" style="display: none;"></div>
                    </div>
                </div>

                <div class="upload-group">
                    <label data-zh="录音URL (可选)" data-en="Recording URL (Optional)">录音URL (可选)</label>
                    <input 
                        type="url" 
                        id="recording-url" 
                        placeholder="https://example.com/recording.mp3"
                        data-zh-placeholder="https://example.com/recording.mp3 (可选)"
                        data-en-placeholder="https://example.com/recording.mp3 (optional)"
                    >
                    <small data-zh="如有原始录音链接，可提供以获得更准确的分析" data-en="If you have original recording link, provide it for more accurate analysis">
                        如有原始录音链接，可提供以获得更准确的分析
                    </small>
                </div>

                <button class="btn-analyze" id="analyze-interview-btn" onclick="analyzeInterview()" disabled>
                    <i class="fas fa-cog fa-spin" style="display: none;"></i>
                    <span data-zh="开始分析面试" data-en="Start Interview Analysis">开始分析面试</span>
                </button>
            </div>

            <div class="result-section" id="interview-result" style="display: none;">
                <h3 data-zh="分析结果" data-en="Analysis Result">分析结果</h3>
                <div class="result-content markdown-content" id="interview-result-content"></div>
                <div class="result-actions">
                    <button class="btn-secondary" onclick="saveReportToSupabase('interview')">
                        <i class="fas fa-save"></i>
                        <span data-zh="保存到我的报告" data-en="Save to My Reports">保存到我的报告</span>
                    </button>
                    <button class="btn-secondary" onclick="downloadResultDocx('interview')">
                        <i class="fas fa-file-word"></i>
                        <span data-zh="下载 Word" data-en="Download Word">下载 Word</span>
                    </button>
                    <button class="btn-secondary" onclick="downloadResult('interview')">
                        <i class="fas fa-download"></i>
                        <span data-zh="下载 Markdown" data-en="Download Markdown">下载 Markdown</span>
                    </button>
                    <button class="btn-primary" onclick="resetInterviewAnalysis()">
                        <span data-zh="重新分析" data-en="Analyze Again">重新分析</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 我的报告模块 -->
        <div class="analysis-module" id="my-reports-module" style="display: none;">
            <div class="module-header">
                <button class="back-btn" onclick="showHome()">
                    <i class="fas fa-arrow-left"></i>
                    <span>返回</span>
                </button>
                <h2>我的报告</h2>
            </div>
            <div id="my-reports-content">
                <p id="reports-notice" class="notice">请先登录后查看与保存报告。</p>
                <!-- 子标签 -->
                <div class="tab-container" style="margin: 0.5rem 0 1rem;">
                    <button class="tab-button active" id="tab-reports" onclick="switchReportsTab('reports')">报告列表</button>
                    <button class="tab-button" id="tab-resume" onclick="switchReportsTab('resume')">简历历史</button>
                    <button class="tab-button" id="tab-interview" onclick="switchReportsTab('interview')">面试历史</button>
                </div>
                
                <!-- 报告列表标签页 -->
                <div id="reports-tab-content" class="tab-content-panel">
                    <div class="result-actions" style="margin-bottom:1rem">
                        <button class="btn-secondary" id="subtab-refresh-btn" onclick="loadMyReports()">
                            <i class="fas fa-sync"></i>
                            刷新列表
                        </button>
                    </div>
                    <!-- 报告列表 -->
                    <div id="reports-list" class="result-content markdown-content"></div>
                </div>

                <!-- 简历历史标签页 -->
                <div id="resume-tab-content" class="tab-content-panel" style="display:none">
                    <!-- 筛选和搜索 -->
                    <div class="history-filters">
                        <div class="filter-group">
                            <label for="resumeDateFilter">时间筛选：</label>
                            <select id="resumeDateFilter" class="filter-select">
                                <option value="all">全部时间</option>
                                <option value="today">今天</option>
                                <option value="week">最近一周</option>
                                <option value="month">最近一月</option>
                                <option value="quarter">最近三月</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="resumeStatusFilter">状态筛选：</label>
                            <select id="resumeStatusFilter" class="filter-select">
                                <option value="all">全部状态</option>
                                <option value="completed">分析完成</option>
                                <option value="processing">分析中</option>
                                <option value="failed">分析失败</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <input type="text" id="resumeSearchInput" placeholder="搜索简历文件名或岗位..." class="search-input">
                            <button class="search-btn" onclick="searchResumeRecords()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 统计信息 -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="resumeTotalAnalyses">0</h3>
                                <p>总分析次数</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="resumeAvgScore">0分</h3>
                                <p>平均匹配度</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="resumeThisMonth">0</h3>
                                <p>本月分析</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="resumeBestScore">0分</h3>
                                <p>最高匹配度</p>
                            </div>
                        </div>
                    </div>

                    <!-- 历史记录列表 -->
                    <div class="history-list">
                        <div class="list-header">
                            <h2>分析记录</h2>
                            <button class="btn-primary" onclick="showResumeAnalysis()">
                                <i class="fas fa-plus"></i>
                                新建分析
                            </button>
                        </div>

                        <!-- 记录项模板 -->
                        <div id="resumeRecordsList" class="records-container">
                            <!-- 加载状态 -->
                            <div class="loading-state" id="resumeLoadingState">
                                <div class="loading-spinner"></div>
                                <p>正在加载分析记录...</p>
                            </div>

                            <!-- 空状态 -->
                            <div class="empty-state" id="resumeEmptyState" style="display: none;">
                                <div class="empty-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <h3>暂无分析记录</h3>
                                <p>您还没有进行过简历分析，点击下方按钮开始您的第一次分析</p>
                                <button class="btn-primary" onclick="showResumeAnalysis()">
                                    <i class="fas fa-plus"></i>
                                    开始分析
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 面试历史标签页 -->
                <div id="interview-tab-content" class="tab-content-panel" style="display:none">
                    <!-- 筛选和搜索 -->
                    <div class="history-filters">
                        <div class="filter-group">
                            <label for="interviewDateFilter">时间筛选：</label>
                            <select id="interviewDateFilter" class="filter-select">
                                <option value="all">全部时间</option>
                                <option value="today">今天</option>
                                <option value="week">最近一周</option>
                                <option value="month">最近一月</option>
                                <option value="quarter">最近三月</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="interviewStatusFilter">状态筛选：</label>
                            <select id="interviewStatusFilter" class="filter-select">
                                <option value="all">全部状态</option>
                                <option value="completed">分析完成</option>
                                <option value="processing">分析中</option>
                                <option value="failed">分析失败</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <input type="text" id="interviewSearchInput" placeholder="搜索面试岗位或公司..." class="search-input">
                            <button class="search-btn" onclick="searchInterviewRecords()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 统计信息 -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="interviewTotalAnalyses">0</h3>
                                <p>总分析次数</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="interviewAvgScore">0分</h3>
                                <p>平均面试得分</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="interviewThisMonth">0</h3>
                                <p>本月分析</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="interviewBestScore">0分</h3>
                                <p>最高得分</p>
                            </div>
                        </div>
                    </div>

                    <!-- 历史记录列表 -->
                    <div class="history-list">
                        <div class="list-header">
                            <h2>分析记录</h2>
                            <button class="btn-primary" onclick="showInterviewAnalysis()">
                                <i class="fas fa-plus"></i>
                                新建分析
                            </button>
                        </div>

                        <!-- 记录项模板 -->
                        <div id="interviewRecordsList" class="records-container">
                            <!-- 加载状态 -->
                            <div class="loading-state" id="interviewLoadingState">
                                <div class="loading-spinner"></div>
                                <p>正在加载分析记录...</p>
                            </div>

                            <!-- 空状态 -->
                            <div class="empty-state" id="interviewEmptyState" style="display: none;">
                                <div class="empty-icon">
                                    <i class="fas fa-microphone"></i>
                                </div>
                                <h3>暂无分析记录</h3>
                                <p>您还没有进行过面试分析，点击下方按钮开始您的第一次分析</p>
                                <button class="btn-primary" onclick="showInterviewAnalysis()">
                                    <i class="fas fa-plus"></i>
                                    开始分析
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 详情模态框 -->
        <div class="modal-overlay" id="detailModal" style="display: none;">
            <div class="modal-content detail-modal">
                <div class="modal-header">
                    <h3 id="modalTitle">分析详情</h3>
                    <button class="modal-close" onclick="closeDetailModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- 详情内容将在这里动态加载 -->
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeDetailModal()">关闭</button>
                    <button class="btn-primary" onclick="downloadReport()">
                        <i class="fas fa-download"></i>
                        下载报告
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载提示 -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3 data-zh="AI正在分析中..." data-en="AI is analyzing...">AI正在分析中...</h3>
            <p data-zh="请稍候，这可能需要几分钟时间" data-en="Please wait, this may take a few minutes">请稍候，这可能需要几分钟时间</p>
        </div>
    </div>

    <!-- 错误提示 -->
    <div class="toast" id="toast"></div>

    <!-- 登录模态框已移除，现在使用独立登录页面 -->

    <!-- 重置密码弹窗 -->
    <div class="modal-overlay" id="reset-modal" style="display:none;">
        <div class="modal-panel login-panel">
            <div class="modal-header">
                <h3>重置密码</h3>
                <button class="modal-close" onclick="closeResetModal()" aria-label="关闭">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="modal-subtitle">请设置一个新的密码</p>

            <div class="form-group">
                <label for="reset-password">新密码</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="reset-password" placeholder="不少于6位" autocomplete="new-password" />
                </div>
            </div>

            <div class="form-group">
                <label for="reset-password-confirm">确认新密码</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="reset-password-confirm" placeholder="再次输入" autocomplete="new-password" />
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-primary" onclick="handlePasswordUpdate()">
                    <i class="fas fa-key"></i>
                    更新密码
                </button>
            </div>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div class="modal-overlay auth-container" id="login-modal" style="display: none;">
        <div class="auth-card">
            <button class="modal-close" onclick="closeLoginModal()" aria-label="关闭">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="auth-logo">
                AI
            </div>
            
            <h2 class="auth-title">欢迎回来</h2>
            <p class="auth-subtitle">登录您的AI招聘分析账户</p>

            <div class="tab-container">
                <button class="tab-button active" onclick="switchAuthTab('login')">登录</button>
                <button class="tab-button" onclick="switchAuthTab('register')">注册</button>
            </div>

            <!-- 登录表单 -->
            <div id="modal-login-tab" class="tab-content active">
                <form id="modal-login-form">
                    <div class="form-group">
                        <input type="email" id="modal-login-email" class="form-input" placeholder="请输入您的邮箱地址" required>
                        <label class="form-label" for="modal-login-email">邮箱地址</label>
                        <div class="error-message" id="modal-login-email-error"></div>
                    </div>

                    <div class="form-group">
                        <input type="password" id="modal-login-password" class="form-input" placeholder="请输入您的密码" required>
                        <label class="form-label" for="modal-login-password">密码</label>
                        <div class="error-message" id="modal-login-password-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="modal-remember-me" class="checkbox-input" checked>
                            <span class="checkbox-checkmark"></span>
                            <span class="checkbox-label">记住我的登录状态</span>
                        </label>
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="auth-button" id="modal-login-button">
                            <span class="loading-spinner" id="modal-login-spinner" style="display: none;"></span>
                            登录
                        </button>
                    </div>

                    <div class="error-message" id="modal-login-error"></div>
                    <div class="success-message" id="modal-login-success"></div>
                </form>

                <div class="auth-links">
                    <a href="#" class="auth-link" onclick="showModalForgotPassword()">忘记密码？</a>
                </div>
            </div>

            <!-- 注册表单 -->
            <div id="modal-register-tab" class="tab-content">
                <form id="modal-register-form">
                    <div class="form-group">
                        <label class="form-label" for="modal-register-name">姓名</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="modal-register-name" class="form-input" placeholder="请输入您的姓名" required>
                        </div>
                        <div class="error-message" id="modal-register-name-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="modal-register-email">邮箱地址</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="modal-register-email" class="form-input" placeholder="请输入您的邮箱" required>
                        </div>
                        <div class="error-message" id="modal-register-email-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="modal-register-password">密码</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="modal-register-password" class="form-input" placeholder="请输入密码（至少6位）" required>
                        </div>
                        <div class="error-message" id="modal-register-password-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="modal-register-confirm">确认密码</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="modal-register-confirm" class="form-input" placeholder="再次输入密码" required>
                        </div>
                        <div class="error-message" id="modal-register-confirm-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="modal-agree-terms" class="checkbox-input" required>
                            <span class="checkbox-checkmark"></span>
                            <span class="checkbox-label">我同意用户协议和隐私政策</span>
                        </label>
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="auth-button" id="modal-register-button">
                            <span class="loading-spinner" id="modal-register-spinner" style="display: none;"></span>
                            注册
                        </button>
                    </div>

                    <div class="error-message" id="modal-register-error"></div>
                    <div class="success-message" id="modal-register-success"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Markdown 渲染与安全过滤库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <!-- HTML to DOCX 转换库（浏览器端生成 Word 文档） -->
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js/dist/html-docx.js"></script>

    <script src="js/i18n.js"></script>
    <script src="js/error-handler.js"></script>
    <!-- 环境配置（必须在其他模块之前加载） -->
    <script src="js/env-config.js"></script>
    <!-- API 调用模块（提供 window.API 全局对象，必须在 main.js 使用前加载） -->
    <script src="js/api.js"></script>
    <!-- Supabase JS（UMD 版本，提供 window.supabase 全局对象） -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js" crossorigin="anonymous"></script>
    <script type="module" src="js/supabase.js"></script>
    <script type="module" src="js/notification.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/api-integration.js"></script>
    <script type="module" src="js/main.js"></script>
    <!-- 已移除 API 调试按钮脚本 -->
</body>
</html>