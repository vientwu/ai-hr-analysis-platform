# 生产环境部署检查清单

## 📋 部署前检查清单

### 1. 代码质量检查
- [ ] 所有代码已提交到主分支
- [ ] 代码通过所有测试用例
- [ ] 代码已通过安全审计
- [ ] 移除所有调试代码和console.log
- [ ] 确认没有硬编码的敏感信息

### 2. 环境配置检查
- [ ] `.env.example` 文件已更新
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 生产环境变量已准备就绪
- [ ] `vercel.json` 配置正确
- [ ] API 路由配置正确

### 3. 依赖和构建检查
- [ ] `package.json` 依赖版本锁定
- [ ] `package-lock.json` 已提交
- [ ] 构建脚本运行正常
- [ ] 静态资源优化完成
- [ ] 代码压缩和混淆配置

### 4. 数据库配置检查
- [ ] Supabase 项目已创建
- [ ] 数据库表结构已部署
- [ ] RLS 策略已配置
- [ ] 数据库连接测试通过
- [ ] 备份策略已设置

### 5. 第三方服务检查
- [ ] Coze AI API 密钥已配置
- [ ] API 调用限制已了解
- [ ] 错误处理机制已实现
- [ ] 服务监控已设置

### 6. 安全配置检查
- [ ] HTTPS 强制启用
- [ ] CSP 策略已配置
- [ ] CORS 策略已设置
- [ ] XSS 防护已启用
- [ ] 敏感数据加密存储

### 7. 性能优化检查
- [ ] 图片资源已优化
- [ ] CSS/JS 文件已压缩
- [ ] 缓存策略已配置
- [ ] CDN 配置已设置
- [ ] 懒加载已实现

### 8. 监控和日志检查
- [ ] 错误监控已配置
- [ ] 性能监控已设置
- [ ] 日志记录已实现
- [ ] 告警机制已配置
- [ ] 健康检查端点已设置

## 🚀 Vercel 部署步骤

### 步骤 1: 环境准备
```bash
# 1. 安装 Vercel CLI
npm install -g vercel

# 2. 登录 Vercel
vercel login

# 3. 运行部署前检查
npm run pre-deploy:check
```

### 步骤 2: 环境变量配置
在 Vercel Dashboard 中配置以下环境变量：

**必需变量:**
- `SUPABASE_URL`: Supabase 项目 URL
- `SUPABASE_ANON_KEY`: Supabase 匿名密钥
- `COZE_PAT`: Coze AI 个人访问令牌
- `COZE_RESUME_WORKFLOW_ID`: 简历分析工作流 ID
- `COZE_INTERVIEW_WORKFLOW_ID`: 面试分析工作流 ID

**可选变量:**
- `NODE_ENV`: 设置为 `production`
- `CORS_ORIGIN`: 允许的 CORS 域名

### 步骤 3: 部署执行
```bash
# 方法 1: 使用自动化脚本
npm run deploy

# 方法 2: 手动部署
vercel --prod
```

### 步骤 4: 部署后验证
```bash
# 运行部署后测试
npm run post-deploy:test

# 手动验证清单
# - [ ] 网站可正常访问
# - [ ] 用户注册功能正常
# - [ ] 用户登录功能正常
# - [ ] 简历分析功能正常
# - [ ] 面试分析功能正常
# - [ ] 数据持久化正常
# - [ ] 错误处理正常
```

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 部署失败
**问题**: Vercel 部署过程中失败
**解决方案**:
- 检查 `vercel.json` 配置
- 确认所有依赖已正确安装
- 查看 Vercel 部署日志
- 验证环境变量配置

#### 2. API 调用失败
**问题**: Serverless 函数调用失败
**解决方案**:
- 检查环境变量是否正确设置
- 验证 API 密钥是否有效
- 查看函数执行日志
- 检查网络连接和防火墙设置

#### 3. 数据库连接失败
**问题**: Supabase 连接失败
**解决方案**:
- 验证 Supabase URL 和密钥
- 检查 RLS 策略配置
- 确认数据库表结构
- 测试网络连接

#### 4. 认证问题
**问题**: 用户认证失败
**解决方案**:
- 检查 Supabase Auth 配置
- 验证重定向 URL 设置
- 确认邮件模板配置
- 测试认证流程

## 📊 部署后监控

### 关键指标监控
- **可用性**: 网站正常运行时间
- **性能**: 页面加载时间和 API 响应时间
- **错误率**: 4xx/5xx 错误比例
- **用户活跃度**: 注册和登录用户数量
- **功能使用率**: 简历和面试分析使用频率

### 监控工具推荐
- **Vercel Analytics**: 内置性能监控
- **Sentry**: 错误监控和性能追踪
- **Google Analytics**: 用户行为分析
- **Uptime Robot**: 网站可用性监控

## 🔄 持续部署

### 自动化部署流程
1. **代码提交**: 推送到主分支
2. **自动构建**: Vercel 自动触发构建
3. **自动测试**: 运行测试套件
4. **自动部署**: 测试通过后自动部署
5. **部署验证**: 自动运行部署后测试

### 回滚策略
- **快速回滚**: 使用 Vercel Dashboard 一键回滚
- **版本管理**: 保留最近 10 个部署版本
- **数据备份**: 定期备份数据库
- **监控告警**: 异常时自动通知

## ✅ 部署完成确认

部署完成后，请确认以下项目：

- [ ] 生产环境 URL 可正常访问
- [ ] 所有功能模块正常工作
- [ ] 用户认证流程完整
- [ ] 数据存储和检索正常
- [ ] 错误处理机制有效
- [ ] 性能指标达到预期
- [ ] 安全配置生效
- [ ] 监控系统正常运行
- [ ] 备份策略已实施
- [ ] 文档已更新

---

**注意**: 请在每次部署前仔细检查此清单，确保生产环境的稳定性和安全性。